name: MLOps Continuous Integration

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  pipeline-validation:
    name: Build and Validate Pipeline
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python 3.9
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          cache: 'pip'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Run Model Quality Check
        run: |
          echo "Starting Model Health and Quality Validation..."
          # Validates if the quality check module is operational
          python -c "from src.monitoring.quality_check import run_quality_check; print('Monitoring Module: OK')"

      - name: Validate Pipeline Architecture
        run: |
          echo "Verifying Training Pipeline Structure..."
          # Checks if the main pipeline can be imported without errors
          python -c "import pipelines.training_pipeline; print('Pipeline Architecture: Verified')"

      - name: Check Feature Engineering Logic
        run: |
          echo "Testing Feature Engineering Modules..."
          python -c "from src.features.build_features import apply_feature_engineering; print('Feature Engineering: OK')"

      - name: Deployment Readiness
        run: |
          echo "Final check for deployment artifacts..."
          echo "CI/CD Pipeline Status: SUCCESS"